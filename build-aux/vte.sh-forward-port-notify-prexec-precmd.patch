diff --git a/src/vte.sh.in b/src/vte.sh.in
index 2328a9ec..54e07486 100644
--- a/src/vte.sh.in
+++ b/src/vte.sh.in
@@ -32,11 +32,18 @@ __vte_osc7 () {
     printf "\033]7;file://%s%s\033\\" "${HOSTNAME}" "$(@libexecdir@/vte-urlencode-cwd)"
 }
 
+__vte_shell_precmd() {
+    local command=$(HISTTIMEFORMAT= history 1 | sed 's/^ *[0-9]\+ *//')
+    command="${command//;/ }"
+    printf '\033]777;notify;Command completed;%s\033\\\033]777;precmd\033\\' "${command}"
+}
+
 __vte_prompt_command() {
     local pwd='~'
     [ "$PWD" != "$HOME" ] && pwd=${PWD/#$HOME\//\~\/}
     pwd="${pwd//[[:cntrl:]]}"
     printf "\033]0;%s@%s:%s\033\\" "${USER}" "${HOSTNAME%%.*}" "${pwd}"
+    __vte_shell_precmd
     __vte_osc7
 }
 
@@ -49,11 +56,14 @@ if [[ -n "${BASH_VERSION:-}" ]]; then
     # use the __vte_prompt_command function which also sets the title.
 
     if [[ "$(declare -p PROMPT_COMMAND 2>&1)" =~ "declare -a" ]]; then
+	PROMPT_COMMAND+=(__vte_shell_precmd)
 	PROMPT_COMMAND+=(__vte_osc7)
     else
 	PROMPT_COMMAND="__vte_prompt_command"
     fi
 
+    PS0=$(printf "\033]777;preexec\033\\")"${PS0:-}"
+
     # Shell integration
     if [[ "$PS1" != *\]133\;* ]]; then
 
@@ -84,6 +94,7 @@ if [[ -n "${BASH_VERSION:-}" ]]; then
     fi
 
 elif [[ -n "${ZSH_VERSION:-}" ]]; then
+    precmd_functions+=(__vte_shell_precmd)
     precmd_functions+=(__vte_osc7)
 
     # Shell integration (see the bash counterpart for more detailed comments)
